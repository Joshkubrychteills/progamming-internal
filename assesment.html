<!doctype html>

<body>
    <canvas id="gameCanvas" width="700" height="500"> </canvas>
    <script>
        var canvas, canvasContext;

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);
            
            for(var i = 0; i < totalBars; i++){
                makebars();
            }

            setInterval(mainloop, 1000 / 50);
        }

        //const and vars
        var playerXpos = 0; //player
        var playerYpos = 0;
        var PlayerXspeed = 8;
        const playerSize = 20;

        var EnemyXpos = 700; //enemy
        var EnemyYpos = 0;
        var EnemyXspeed = 5;
        var EnemyYSize = 450;
        var EnemyXSize = 50;

        var yVel = 0; //gravity
        var jumpPower = -6;
        var fallRate = 0.2;

        var gameRun = true;

        const RIGHT_KEY = 39; //player move
        const LEFT_KEY = 37;
        const SPACE_KEY = 32;
        var spaceKeyPressed = false;
        var leftKeyPressed = false;
        var rightKeyPressed = false;

        function mainloop() {
            if (gameRun) {
                colorRect(0, 0, canvas.width, canvas.height, 'black'); // bg
                colorRect(playerXpos, playerYpos, playerSize, playerSize, 'blue'); // player
                colorRect(EnemyXpos, EnemyYpos, EnemyXSize, EnemyYSize, 'Red'); //bar
                
                Playermove();
                EnemyMove();
                GameConditions();
            } else {
                colorRect(0, 0, canvas.width, canvas.height, 'black'); // bg
                colorText('Game over',100,100,'20px Arial','red'); 
            }

        }

        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);

        }
        
        function colorText(msg,x,y,f,c) {
            canvasContext.font = f;
            canvasContext.fillStyle = c;
            canvasContext.fillText(msg, x, y);

        }

        function GameConditions() {
            if (playerXpos + playerSize > EnemyXpos && playerXpos < EnemyXpos + EnemyXSize && playerYpos + playerSize > EnemyYpos && playerYpos < EnemyYpos + EnemyYSize) {
                gameRun = false;
            }

        }
        
        var bars = [];
        var totalBars = 10;
        var barCount = 0;
        
        function makebars() {
            var barWidth = 20;
            var barXspeed = Math.floor(Math.random()*(12 - 5)) + 5;
            var barHeight = Math.floor(Math.random()*(50 - 30)) + 30;
            var barXpos = canvas.width - barCount * barWidth;
            var barYpos = Math.floor(Math.random()*(canvas.height - barHeight));
            
            var bar = {
                barXpos: barXpos,
                barYpos: barYpos,
                barWidth: barWidth,
                barHeight: barHeight,
                barXspeed: barXspeed
            }
            
            bars.push(bar); 
        }

        function Playermove() { //playerMove

            if (spaceKeyPressed) {
                yVel = jumpPower;

            }

            playerYpos += yVel;
            yVel += fallRate;
            if (playerYpos > canvas.height) {

            }
            if (playerYpos < 0) {
                playerYpos = 0;
                yVel = fallRate;
            }
            if (playerYpos + playerSize / 2 > canvas.height) {
                playerYpos = canvas.height - playerSize;
            }

            if (playerXpos > canvas.width) {
                playerXpos = 0;

            }
            if (playerXpos < 0) {
                playerXpos = canvas.width - playerSize;
            }
            if (rightKeyPressed) {
                playerXpos += PlayerXspeed;

            }

            if (leftKeyPressed) {
                playerXpos -= PlayerXspeed;

            }

        }

        function EnemyMove() {
            EnemyXpos -= EnemyXspeed
            if (EnemyXpos < 0) {
                EnemyXpos = canvas.width
            }
        }





        function keyPressed(evt) {
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPressed = true;
            }
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = true;
            }
        }

        function keyReleased(evt) {
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPressed = false;
            }
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = false;
            }

        }

    </script>
</body>
